<!DOCTYPE html>
<html>
<head>
    <title>Lyrics Script</title>

    <script src="./libs/d3.v3.min.js"></script>
    <!--script src="./libs/lyricsNew.js"></script -->
    <script src="./libs/FileSaver.js"></script>
    <script src="./libs/jquery-1.10.1.js"></script>
    <script src="./libs/jquery.csv-0.71.js"></script>




</head>
<body>

<script type="text/javascript">

var lyricsWeWant;

var lyricGroups;
var lyricsReference = [];
var trackData;
var trackMap;
var categories = [];

// ------------------------------------------------------------------------------------
// data files should be in ./data/

var STEMGROUP = "stemGroupingsNew.csv";      // used to derive lyricgroups


 // 5000 words in this file
  // key, stem, group
  /*
  We have to remove ones without groups
  and put the others into groups
  category: xxx; stems: [n..n]
  */

  d3.text("./data/" + STEMGROUP, function(text) {

    allStems = d3.csv.parse(text);
    
    stemMap = createLyricReference(allStems);


    // saveToFile(stemMap, "lyricsReference.json");
          
    });
 
  



// ==========================================
function createLyricReference(allStems) {
  var stemArray = [];
  var stemMap = d3.map();


// (must manually copy from downloads directory into data once done)

// sort the array
allStems.sort(function (a,b) {
    if (a.group > b.group) {
        return 1;
    }
    else if (a.group < b.group) {
      return -1;
    }
    else {
      return 0;
    }
  });

currentGroup = allStems[0].group; // get first

allStems.forEach(function(row){

  if (row.group == currentGroup) {
    // add stems to array
    stemArray.push({"id": row.key, "stem": row.stem});
  }
  else {
    if (currentGroup != "") {
      stemMap.set(currentGroup, stemArray);
    }
    stemArray = []; // clear array
    stemArray.push({"id": row.key, "stem": row.stem});
    currentGroup = row.group; // next group
  }
});

console.log("Done");
return stemMap;


 
}


// ===============================================
  var saveToFile = function(object, filename){

      var blob, blobText;
      blobText = [JSON.stringify(object, '\t')];
      blob = new Blob(blobText, {
          type: "text/plain;charset=utf-8"
      });
      saveAs(blob, filename);
     
  }




    var saveArrayToFile = function(arrayOfLines, fileName) {
     /* adds linebreaks at the end*/
     var blob, blobText;
     blobText = arrayOfLines.map(function(d) {
       if (d.endsWith("\n")) {
         return d;
       } else {
         return d + "\n";
       }
     });
     blob = new Blob(blobText, {
       type: "text/plain;charset=utf-8"
     });
     return saveAs(blob, fileName);
   };

   String.prototype.endsWith = function(suffix) {
     return this.indexOf(suffix, this.length - suffix.length) !== -1;
   };




</script>
</body>
</html>